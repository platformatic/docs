"use strict";(self.webpackChunkplatformatic_oss_website=self.webpackChunkplatformatic_oss_website||[]).push([[1147],{8507:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>p,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var n=t(4848),r=t(8453);const i={},a="Migrating an Express app to Platformatic Service",o={id:"guides/migrating-express-app-to-platformatic-service",title:"Migrating an Express app to Platformatic Service",description:"Introduction",source:"@site/docs/guides/migrating-express-app-to-platformatic-service.md",sourceDirName:"guides",slug:"/guides/migrating-express-app-to-platformatic-service",permalink:"/docs/next/guides/migrating-express-app-to-platformatic-service",draft:!1,unlisted:!1,editUrl:"https://github.com/platformatic/platformatic/edit/main/docs/guides/migrating-express-app-to-platformatic-service.md",tags:[],version:"current",frontMatter:{},sidebar:"Learn",previous:{title:"Migrating a Fastify app to Platformatic Service",permalink:"/docs/next/guides/migrating-fastify-app-to-platformatic-service"},next:{title:"Telemetry with Jaeger",permalink:"/docs/next/guides/telemetry"}},p={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Example Express application",id:"example-express-application",level:2},{value:"Creating a new Platformatic Service app",id:"creating-a-new-platformatic-service-app",level:2},{value:"Using ES modules",id:"using-es-modules",level:3},{value:"Migrate the Express routes",id:"migrate-the-express-routes",level:2},{value:"Install @fastify/express",id:"install-fastifyexpress",level:3},{value:"Mounting the Express routes",id:"mounting-the-express-routes",level:3},{value:"Configuring the Platformatic Service app",id:"configuring-the-platformatic-service-app",level:3},{value:"Using @fastify/express with Platformatic Runtime",id:"using-fastifyexpress-with-platformatic-runtime",level:3},{value:"Wrapping up",id:"wrapping-up",level:2}];function l(e){const s={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.header,{children:(0,n.jsx)(s.h1,{id:"migrating-an-express-app-to-platformatic-service",children:"Migrating an Express app to Platformatic Service"})}),"\n",(0,n.jsx)(s.h2,{id:"introduction",children:"Introduction"}),"\n",(0,n.jsxs)(s.p,{children:["Our open-source tools are built on top of the modern and flexible ",(0,n.jsx)(s.a,{href:"https://www.fastify.io/",children:"Fastify"})," web framework. It provides logging, request validation and a powerful plugin system out-of-the-box, as well as ",(0,n.jsx)(s.a,{href:"https://www.fastify.io/benchmarks/",children:"incredible performance"}),"."]}),"\n",(0,n.jsxs)(s.p,{children:["If you have an existing ",(0,n.jsx)(s.a,{href:"http://expressjs.com/",children:"Express"})," application, migrating it to Fastify could potentially be time-consuming, and might not be something that you're able to prioritise right now. You can however still take advantage of Fastify and our open-source tools. In this guide you'll learn how to use the ",(0,n.jsx)(s.a,{href:"https://www.npmjs.com/package/@fastify/express",children:(0,n.jsx)(s.code,{children:"@fastify/express"})})," plugin to help you rapidly migrate your existing Express application to use Platformatic Service."]}),"\n",(0,n.jsxs)(s.p,{children:["This guide assumes that you have some experience building applications with the ",(0,n.jsx)(s.a,{href:"https://expressjs.com/",children:"Express"})," framework."]}),"\n",(0,n.jsx)(s.h2,{id:"example-express-application",children:"Example Express application"}),"\n",(0,n.jsx)(s.p,{children:"For the purpose of this guide, we have a basic example Express application. Although this app has a specific structure, the migration steps covered in this guide can generally be applied to any Express application."}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["The code for the example Express and migrated Platformatic Service applications is available ",(0,n.jsx)(s.a,{href:"https://github.com/platformatic/examples/tree/main/applications/deploy-express-app-platformatic-cloud",children:"on GitHub"}),"."]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"Here's the structure of the example Express application:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{children:"\u251c\u2500\u2500 app.js\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 routes\n\u2502   \u2514\u2500\u2500 users.js\n\u2514\u2500\u2500 server.js\n"})}),"\n",(0,n.jsx)(s.p,{children:"It has the following dependencies:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",children:'// package.json\n\n"dependencies": {\n  "express": "^4.18.2"\n}\n'})}),"\n",(0,n.jsxs)(s.p,{children:["The application has routes in ",(0,n.jsx)(s.code,{children:"routes/users.js"}),":"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"// routes/users.js\n\nimport express from 'express'\n\nconst router = express.Router()\n\nrouter.use(express.json())\n\nrouter.post('/', function createUser(request, response, next) {\n  const newUser = request.body\n\n  if (!newUser) {\n    return next(new Error('Error creating user'))\n  }\n\n  response.status(201).json(newUser)\n})\n\nrouter.get('/:user_id', function getUser(request, response, next) {\n  const user = {\n    id: Number(request.params.user_id),\n    first_name: 'Bobo',\n    last_name: 'Oso'\n  }\n\n  response.json(user)\n})\n\nexport const usersRoutes = router\n"})}),"\n",(0,n.jsxs)(s.p,{children:["In ",(0,n.jsx)(s.code,{children:"app.js"}),", we have a factory function that creates a new Express server instance and mounts the routes:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"// app.js\n\nimport express from 'express'\n\nimport { usersRoutes } from './routes/users.js'\n\nexport default function buildApp() {\n  const app = express()\n\n  app.use('/users', usersRoutes)\n\n  return app\n}\n"})}),"\n",(0,n.jsxs)(s.p,{children:["And in ",(0,n.jsx)(s.code,{children:"server.js"})," we're calling the factory function and starting the server listening for HTTP requests:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"// server.js\n\nimport buildApp from './app.js'\n\nconst express = buildApp()\n\nexpress.listen(3042, () => {\n  console.log('Example app listening at http://localhost:3042')\n})\n"})}),"\n",(0,n.jsxs)(s.blockquote,{children:["\n",(0,n.jsxs)(s.p,{children:["The routes in your Express application should be mounted on an Express router (or multiple routers if needed). This will allow them to be mounted using ",(0,n.jsx)(s.code,{children:"@fastify/express"})," when you migrate your app to Platformatic Service."]}),"\n"]}),"\n",(0,n.jsx)(s.h2,{id:"creating-a-new-platformatic-service-app",children:"Creating a new Platformatic Service app"}),"\n",(0,n.jsx)(s.p,{children:"To migrate your Express app to Platformatic Service, create a new Platformatic Service app with:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"npm create platformatic@latest\n"})}),"\n",(0,n.jsxs)(s.p,{children:["Be sure to select ",(0,n.jsx)(s.code,{children:"Service"})," as the project type."]}),"\n",(0,n.jsxs)(s.p,{children:["Once the project has been created, you can delete the example ",(0,n.jsx)(s.code,{children:"plugins"})," and ",(0,n.jsx)(s.code,{children:"routes"})," directories."]}),"\n",(0,n.jsx)(s.h3,{id:"using-es-modules",children:"Using ES modules"}),"\n",(0,n.jsxs)(s.p,{children:["If you're using ES modules in the Express application code that you'll be migrating, ensure that there's a ",(0,n.jsx)(s.code,{children:"type"})," field in ",(0,n.jsx)(s.code,{children:"package.json"})," set to ",(0,n.jsx)(s.code,{children:"module"}),":"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"npm pkg set type=module\n"})}),"\n",(0,n.jsx)(s.h2,{id:"migrate-the-express-routes",children:"Migrate the Express routes"}),"\n",(0,n.jsxs)(s.p,{children:["Copy over the ",(0,n.jsx)(s.code,{children:"routes"})," directory from your Express app."]}),"\n",(0,n.jsx)(s.h3,{id:"install-fastifyexpress",children:"Install @fastify/express"}),"\n",(0,n.jsxs)(s.p,{children:["Install the ",(0,n.jsx)(s.a,{href:"https://www.npmjs.com/package/@fastify/express",children:(0,n.jsx)(s.code,{children:"@fastify/express"})})," Fastify plugin to add full Express compatibility to your Platformatic Service app:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-bash",children:"npm install @fastify/express\n"})}),"\n",(0,n.jsx)(s.h3,{id:"mounting-the-express-routes",children:"Mounting the Express routes"}),"\n",(0,n.jsxs)(s.p,{children:["Create a root Fastify plugin that register's the ",(0,n.jsx)(s.code,{children:"@fastify/express"})," plugin and loads your Express routes:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"// root-plugin.js\n\nimport { usersRoutes } from './routes/users.js'\n\n/** @param {import('fastify').FastifyInstance} app */\nexport default async function (app) {\n  await app.register(import('@fastify/express'))\n\n  app.use('/users', usersRoutes)\n}\n"})}),"\n",(0,n.jsx)(s.h3,{id:"configuring-the-platformatic-service-app",children:"Configuring the Platformatic Service app"}),"\n",(0,n.jsxs)(s.p,{children:["Edit your app's ",(0,n.jsx)(s.code,{children:"platformatic.service.json"})," to load your root plugin:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",children:'// platformatic.service.json\n\n{\n  ...,\n  "plugins": {\n    "paths": [{\n      "path": "./root-plugin.js",\n      "encapsulate": false\n    }]\n  }\n}\n'})}),"\n",(0,n.jsxs)(s.p,{children:["These settings are important when using ",(0,n.jsx)(s.code,{children:"@fastify/express"})," in a Platformatic Service app:"]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"encapsulate"})," \u2014 You'll need to disable encapsulation for any Fastify plugin which mounts Express routes. This is due to the way that ",(0,n.jsx)(s.code,{children:"@fastify/express"})," works."]}),"\n"]}),"\n",(0,n.jsx)(s.h3,{id:"using-fastifyexpress-with-platformatic-runtime",children:"Using @fastify/express with Platformatic Runtime"}),"\n",(0,n.jsxs)(s.p,{children:["If you are using ",(0,n.jsx)(s.a,{href:"/reference/runtime/introduction.md",children:"Platformatic Runtime"}),", you must configure your other services to connect to this one using an actual TCP socket\ninstead of the virtual network."]}),"\n",(0,n.jsxs)(s.p,{children:["Edit your app's ",(0,n.jsx)(s.code,{children:"platformatic.runtime.json"})," and add the ",(0,n.jsx)(s.code,{children:"useHttp"})," option:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-json",children:'{\n  "$schema": "https://schemas.platformatic.dev/@platformatic/runtime/1.52.0.json",\n  "entrypoint": "b",\n  "autoload": {\n    "path": "./services",\n    "mappings": {\n      "myexpressservice": {\n        "id": "a",\n        "config": "platformatic.service.json",\n        "useHttp": true\n      }\n    }\n  },\n  "server": {\n    "hostname": "127.0.0.1",\n    "port": 3000,\n    "logger": {\n      "level": "info"\n    }\n  }\n}\n'})}),"\n",(0,n.jsxs)(s.p,{children:["Where the Platformatic Service using express is located at ",(0,n.jsx)(s.code,{children:"./services/myexpressservice"}),"."]}),"\n",(0,n.jsx)(s.h2,{id:"wrapping-up",children:"Wrapping up"}),"\n",(0,n.jsxs)(s.p,{children:["You can learn more about building Node.js apps with Platformatic service in the ",(0,n.jsx)(s.a,{href:"https://docs.platformatic.dev/docs/reference/service/introduction",children:"Platformatic Service"})," documentation."]}),"\n",(0,n.jsxs)(s.p,{children:["Once you've migrated your Express app to use Platformatic Service with ",(0,n.jsx)(s.code,{children:"@fastify/express"}),", you might then want to consider fully migrating your Express routes and application code to Fastify. This tutorial shows how you can approach that migration process: ",(0,n.jsx)(s.a,{href:"https://simonplend.com/how-to-migrate-your-app-from-express-to-fastify/",children:"How to migrate your app from Express to Fastify"})," (",(0,n.jsx)(s.a,{href:"https://simonplend.com/learning-fastify-how-to-migrate-your-app-from-express-to-fastify/",children:"video"}),")."]})]})}function d(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>a,x:()=>o});var n=t(6540);const r={},i=n.createContext(r);function a(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);